<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head profile="http://gmpg.org/xfn/11">

	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	
	<title>Manuel Aldana &#8212; Software Engineering: blog &amp; .lessons_learned</title>
	
	<meta name="generator" content="WordPress 2.9.2" /> <!-- leave this for stats -->
  <link rel="shortcut icon" href="../../favicon.ico"/>	
	<link rel="stylesheet" href="../../wp-content/themes/cutlineAldana/style.css" type="text/css" media="screen" />
	<link rel="stylesheet" href="../../wp-content/themes/cutlineAldana/custom_css/custom.css" type="text/css" media="screen" />
	<!--[if lte IE 7]>
	<link rel="stylesheet" type="text/css" href="http://www.aldana-online.de/wp-content/themes/cutlineAldana/ie7.css" media="screen" />
	<![endif]-->
	<!--[if lte IE 6]>
	<link rel="stylesheet" type="text/css" href="http://www.aldana-online.de/wp-content/themes/cutlineAldana/ie6.css" media="screen" />
	<![endif]-->
	<link rel="alternate" type="application/rss+xml" title="Manuel Aldana RSS Feed" href="../../feed/index.html" />
	<link rel="pingback" href="../../xmlrpc.php" />
	<meta name="google-site-verification" content="L4vY5UHsSR0hLG7CXwSvTMmUHiV0P59pw6tX8xhm_kM" />

	<link rel="stylesheet" href="../../wp-content/plugins/codesnippet/codesnippet.css" type="text/css" />
<style type="text/css">
.codesnip-container  {border:1px solid #ccc; background:#eee; padding: 5px;margin:10px;}
</style>
<script type='text/javascript' src='../../wp-includes/js/jquery/jquery.js@ver=1.3.2'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../xmlrpc.php@rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='Manuel Aldana' href='../../index.html' />
<meta name="generator" content="WordPress 2.9.2" />
<link rel="stylesheet" href="../../wp-content/plugins/digg-digg/css/diggdigg-style.css@ver=4.2.css" type="text/css" media="screen" /></head>

<body class="custom">
<div id="container">

<div id="header_text_big">
SOFTWARE ENGINEERING blog &amp; .lessons_learned</div>
<div id="header_text_normal">
manuel aldana
</div>
<div id="header_img">		
		<a href="../../index.html"><img src="../../wp-content/themes/cutlineAldana/images/blogLogoAldana.jpg" alt="Manuel Aldana" title="Manuel Aldana" /></a>		
</div>

	<ul id="nav">
		<li class="rss"><a href="../../feed/index.html">RSS</a></li>
	</ul>

	

	<div id="content_box">
	
		<div id="l_sidebar">
	<ul class="sidebar_list">
				<li id="recent-posts-3" class="widget widget_recent_entries">		<h2 class="widgettitle">Last entries</h2>
		<ul>
				<li><a href="../../2018/05/30/notes-on-dsvgo-gdpr-regarding-comment-function/index.html" title="Notes on DSVGO / GDPR regarding comment function">Notes on DSVGO / GDPR regarding comment function </a></li>
				<li><a href="../../2012/01/26/the-evil-path-of-mobile-apps-vs-webstandards/index.html" title="The evil path of Mobile-Apps (vs. Webstandards)&#8230;">The evil path of Mobile-Apps (vs. Webstandards)&#8230; </a></li>
				<li><a href="../../2011/09/30/complexity-drivers-of-software-systems/index.html" title="Complexity drivers of Software-Systems">Complexity drivers of Software-Systems </a></li>
				<li><a href="../../2011/07/03/accessing-rrdtool-files-data-with-java/index.html" title="Accessing rrdtool-files Data with Java / Scala">Accessing rrdtool-files Data with Java / Scala </a></li>
				<li><a href="../../2011/05/15/embracing-failure-softwareapproaches/index.html" title="&#8216;Embrace Failure&#8217; approaches in Software Development">&#8216;Embrace Failure&#8217; approaches in Software Development </a></li>
				<li><a href="../../2011/03/13/top-tools-for-logging-analysis-cli-based/index.html" title="Top-Tools for Log-Analysis (CLI based)">Top-Tools for Log-Analysis (CLI based) </a></li>
				</ul>
		</li>
<li id="flexi-pages" class="widget flexipages_widget"><h2 class="widgettitle">About me</h2>
<ul>
<li class="page_item page-item-2"><a href="../../about/index.html" title="About me/Contact">About me/Contact</a></li>
<li class="page_item page-item-95"><a href="../../it-skills/index.html" title="IT-Skills">IT-Skills</a></li>
<li class="page_item page-item-115"><a href="../../my-bookshelfbook-highlights/index.html" title="Book Highlights">Book Highlights</a></li>
<li class="page_item page-item-14"><a href="../../open-source/index.html" title="Open Source">Open Source</a></li>
<li class="page_item page-item-19"><a href="../../university/index.html" title="University">University</a></li>
<li class="page_item page-item-21"><a href="../../leisure/index.html" title="Hobbies">Hobbies</a></li>
<li class="page_item page-item-6"><a href="../../camphill/index.html" title="Camphill">Camphill</a></li>
</ul>
</li>
<li id="categories-1" class="widget widget_categories"><h2 class="widgettitle">Blog Categories</h2>
		<ul>
	<li class="cat-item cat-item-4"><a href="../../category/software-engineering/continous-integration/index.html" title="View all posts filed under Continous Integration">Continous Integration</a> (7)
</li>
	<li class="cat-item cat-item-3"><a href="../../category/software-engineering/index.html" title="View all posts filed under Software Engineering">Software Engineering</a> (22)
</li>
	<li class="cat-item cat-item-6"><a href="../../category/software-engineering/software-maintenance/index.html" title="View all posts filed under Software Maintenance">Software Maintenance</a> (5)
</li>
	<li class="cat-item cat-item-20"><a href="../../category/software-engineering/technologies-tools/index.html" title="View all posts filed under Technologies/Tools">Technologies/Tools</a> (10)
</li>
	<li class="cat-item cat-item-1"><a href="../../category/uncategorized/index.html" title="View all posts filed under Uncategorized">Uncategorized</a> (5)
</li>
		</ul>
</li>
<li id="linkcat-2" class="widget widget_links"><h2 class="widgettitle">Important SE Links</h2>

	<ul class='xoxo blogroll'>
<li><a href="http://www.artima.com/weblogs/index.jsp?blogger=beckel" title="well known and pragmatic " target="_blank">Bruce Eckel</a></li>
<li><a href="http://www.codinghorror.com/blog/" target="_blank">Coding Horror</a></li>
<li><a href="http://www.dzone.com/links/index.html" target="_blank">DZone</a></li>
<li><a href="http://www.infoq.com/" target="_blank">InfoQ</a></li>
<li><a href="http://www.joelonsoftware.com/" target="_blank">Joel on Software</a></li>
<li><a href="http://martinfowler.com/bliki/" title="one, of the first pushing refactoring to public" target="_blank">Martin Fowler</a></li>
<li><a href="http://www.se-radio.net/" title="very interesting podcasts from different experts all around software engineering" target="_blank">Software Engineering Radio</a></li>
<li><a href="http://theserverside.com" title="all about enterprise applications (especially with java)" target="_blank">TheServerSide</a></li>

	</ul>
</li>

<li id="search-2" class="widget widget_search"><form method="get" id="search_form" action="../../index.html">
	<input type="text" class="search_input" value="To search, type and hit enter" name="s" id="s" onfocus="if (this.value == 'To search, type and hit enter') {this.value = '';}" onblur="if (this.value == '') {this.value = 'To search, type and hit enter';}" />
	<input type="hidden" id="searchsubmit" value="Search" />
</form>
</li>
	</ul>
</div>
		<div id="content" class="posts">

										
						<h4 class="archive_date">>July 3rd, 2011<!-- by manuel aldana --> &middot; <a href="../../2011/07/03/accessing-rrdtool-files-data-with-java/index.html#respond" title="Comment on Accessing rrdtool-files Data with Java / Scala">No Comments</a></h4>
			<h2 class="archive_body"><a href="../../2011/07/03/accessing-rrdtool-files-data-with-java/index.html" rel="bookmark" title="Permanent Link to Accessing rrdtool-files Data with Java / Scala">Accessing rrdtool-files Data with Java / Scala</a></h2>

			<div class="entry">
				<div class='dd_post_share dd_post_share_left'><div class='dd_buttons'><div class='dd_button'><iframe src='http://widgets.dzone.com/links/widgets/zoneit.html?url=http://www.aldana-online.de/2011/07/03/accessing-rrdtool-files-data-with-java/&amp;title=Accessing+rrdtool-files+Data+with+Java+%2F+Scala&amp;t=1' height='68' width='52' frameborder='0' scrolling='no'></iframe></div></div></div><p>Though <a href="http://www.mrtg.org/rrdtool/" target="_blank">rrdtool</a> is widely used especially for monitoring, it took me a while to find a simple and compatible bridge for reading data of rrd-files with Java. Following hopefully helps others to save some time and to workaround some pitfalls.</p>
<p>My requirement was:</p>
<ul>
<li>Monitoring website showing trends of metrics, i.e. compare current with past values, both absolute and relative (hour over hour, day over day, etc.).</li>
<li>Data backed is round-robin-database. The rrd-files are generated by munin (with under the hood rrdtool). Data should be accessed read-only.</li>
<li>Website&#8217;s technology stack is Java based (<a href="http://www.playframework.org/" target="_blank">Play! framework</a> with <a href="http://scala.playframework.org/" target="_blank">Scala integration</a>).</li>
</ul>
<p>Because I use Play! framework I needed a way to access rrd-files with Java-Technology. My first look at <a href="http://code.google.com/p/rrd4j/" target="_blank">rrd4j</a> looked promising but failed, because rrd4j is a port and cannot read rrd-files created by original rrdtool. After some time-consuming research and Google-digging I finally stepped over  <a href="http://oss.stamfest.net/java-rrd-hg/" target="_blank">java-rrd</a>.</p>
<h3>Installation Steps java-rrd</h3>
<p>I couldn&#8217;t find the library built and distributed in any Maven-repository, so you have to download + build yourself:</p>
<div class="codesnip-container" >
<div class="codesnip"><span class="co1"># download + unpack</span><br />
wget http://oss.stamfest.net/java-rrd-hg/archive/tip.tar.gz<br />
tar xfz &lt;downloaded-tarball.tar.gz&gt;<br />
<span class="co1"># build .jar library with Maven</span><br />
<span class="kw3">cd</span> &lt;untarred-directory&gt;<br />
mvn package<br />
cp target/*.jar &lt;your-target-lib-folder&gt;</div>
</div>
<p>Instead of dump-copying and to be more clean with your build-system you might want to deploy the .jar file to a repository like Nexus.</p>
<h3>Read-Access Usage java-rrd</h3>
<p>As I use Play! framework with Scala integration, Scala was the integration way:</p>
<div class="codesnip-container" >
<div class="codesnip"><span class="co2">import net.stamfest.rrd._</span><br />
&#8230;.<br />
<span class="me1">val</span> rrd = <span class="kw2">new</span> RRDp<span class="br0">&#40;</span><span class="st0">&#8220;/tmp&#8221;</span>, <span class="st0">&#8220;55555&#8243;</span><span class="br0">&#41;</span><br />
val command = <a href="http://www.google.com/search?q=allinurl%3AArray+java.sun.com&#038;bntl=1"><span class="kw3">Array</span></a><span class="br0">&#40;</span><span class="st0">&#8220;fetch&#8221;</span>, <span class="st0">&#8220;your-rrd-file.rrd&#8221;</span>, <span class="st0">&#8220;MAX&#8221;</span>, <span class="st0">&#8220;-r&#8221;</span>, <span class="st0">&#8220;1800&#8243;</span>, <span class="st0">&#8220;-s&#8221;</span>, <span class="st0">&#8220;-1d&#8221;</span><span class="br0">&#41;</span><br />
val result = rrd.<span class="me1">command</span><span class="br0">&#40;</span>command<span class="br0">&#41;</span></p>
<p><span class="kw1">if</span> <span class="br0">&#40;</span>!result.<span class="me1">ok</span><span class="br0">&#41;</span><br />
&nbsp; println<span class="br0">&#40;</span>result.<span class="me1">error</span><span class="br0">&#41;</span><br />
<span class="kw1">else</span><br />
&nbsp; println<span class="br0">&#40;</span>result.<span class="me1">output</span><span class="br0">&#41;</span></div>
</div>
<p>For completeness another snippet in Java source language:</p>
<div class="codesnip-container" >
<div class="codesnip"><span class="co2">import net.stamfest.rrd.CommandResult;</span><br />
<span class="co2">import net.stamfest.rrd.RRDp;</span><br />
&#8230;.<br />
<span class="me1">RRDp</span> rrd = <span class="kw2">new</span> RRDp<span class="br0">&#40;</span><span class="st0">&#8220;/tmp&#8221;</span>, <span class="st0">&#8220;55555&#8243;</span><span class="br0">&#41;</span>;<br />
<a href="http://www.google.com/search?q=allinurl%3AString+java.sun.com&#038;bntl=1"><span class="kw3">String</span></a><span class="br0">&#91;</span><span class="br0">&#93;</span> command = <span class="br0">&#123;</span><span class="st0">&#8220;fetch&#8221;</span>, <span class="st0">&#8220;your-rrd-file.rrd&#8221;</span>, <span class="st0">&#8220;MAX&#8221;</span>, <span class="st0">&#8220;-r&#8221;</span>, <span class="st0">&#8220;1800&#8243;</span>, <span class="st0">&#8220;-s&#8221;</span>, <span class="st0">&#8220;-1d&#8221;</span><span class="br0">&#125;</span>;<br />
CommandResult result = rrd.<span class="me1">command</span><span class="br0">&#40;</span>command<span class="br0">&#41;</span>;</p>
<p><span class="kw1">if</span> <span class="br0">&#40;</span>!result.<span class="me1">ok</span><span class="br0">&#41;</span><br />
&nbsp; &nbsp; <a href="http://www.google.com/search?q=allinurl%3ASystem+java.sun.com&#038;bntl=1"><span class="kw3">System</span></a>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">&#40;</span>result.<span class="me1">error</span><span class="br0">&#41;</span>;<br />
<span class="kw1">else</span><br />
&nbsp; &nbsp; <a href="http://www.google.com/search?q=allinurl%3ASystem+java.sun.com&#038;bntl=1"><span class="kw3">System</span></a>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">&#40;</span>result.<span class="me1">output</span><span class="br0">&#41;</span>;</div>
</div>
<p>With java-rrd you can also access rrdtool over sockets/network. </p>
<h3>Parsing rrdtool output</h3>
<p>rrdtool output after fetch is plain text, something like:</p>
<div class="codesnip-container" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;speed<br />
<br/><br />
 920804700: nan<br />
 920805000: 4.0000000000e+02<br />
 920805300: 2.0000000000e+03<br />
 920805600: 0.0000000000e+00<br />
 920806800: 3.3333333333e+01</div>
<p>Above needs to be processed further to be &#8220;structured enough&#8221; for your code. For example do following (I only show Scala, I skipped Java iterating syntax hell&#8230;, did I mention that I love passing functions ;):</p>
<div class="codesnip-container" >
<div class="codesnip">def outputToNumberPairs<span class="br0">&#40;</span>rrdFetchOutput: <a href="http://www.google.com/search?q=allinurl%3AString+java.sun.com&#038;bntl=1"><span class="kw3">String</span></a><span class="br0">&#41;</span> = <span class="br0">&#123;</span><br />
&nbsp; &nbsp; <span class="co1">// filtering unneeded + empty lines</span><br />
&nbsp; &nbsp; val list = rrdFetchOutput.<span class="me1">trim</span><span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">split</span><span class="br0">&#40;</span><span class="st0">&#8220;<span class="es0">\n</span>&#8220;</span><span class="br0">&#41;</span>.<span class="me1">filter</span><span class="br0">&#40;</span><span class="br0">&#40;</span>n<span class="br0">&#41;</span> =&gt; n.<span class="me1">contains</span><span class="br0">&#40;</span><span class="st0">&#8220;:&#8221;</span><span class="br0">&#41;</span> &amp;&amp; !n.<span class="me1">contains</span><span class="br0">&#40;</span><span class="st0">&#8220;nan&#8221;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><br />
&nbsp; &nbsp; <span class="co1">// parsing strings to numeric values and combine to pair</span><br />
&nbsp; &nbsp; <span class="kw1">for</span> <span class="br0">&#40;</span>i &lt;- list<span class="br0">&#41;</span> yield i.<span class="me1">split</span><span class="br0">&#40;</span><span class="st0">&#8220;:&#8221;</span><span class="br0">&#41;</span><span class="br0">&#40;</span><span class="nu0">0</span><span class="br0">&#41;</span>.<span class="me1">trim</span><span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">toLong</span> -&gt; i.<span class="me1">split</span><span class="br0">&#40;</span><span class="st0">&#8220;:&#8221;</span><span class="br0">&#41;</span><span class="br0">&#40;</span><span class="nu0">1</span><span class="br0">&#41;</span>.<span class="me1">trim</span><span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">toFloat</span>.<span class="me1">round</span><br />
&nbsp; <span class="br0">&#125;</span><br />
GIVES BACK:<br />
===<br />
res34: <a href="http://www.google.com/search?q=allinurl%3AArray+java.sun.com&#038;bntl=1"><span class="kw3">Array</span></a><span class="br0">&#91;</span><span class="br0">&#40;</span><a href="http://www.google.com/search?q=allinurl%3ALong+java.sun.com&#038;bntl=1"><span class="kw3">Long</span></a>, Int<span class="br0">&#41;</span><span class="br0">&#93;</span> = <a href="http://www.google.com/search?q=allinurl%3AArray+java.sun.com&#038;bntl=1"><span class="kw3">Array</span></a><span class="br0">&#40;</span><span class="br0">&#40;</span><span class="nu0">920805000</span>,<span class="nu0">400</span><span class="br0">&#41;</span>, <span class="br0">&#40;</span><span class="nu0">920805300</span>,<span class="nu0">2000</span><span class="br0">&#41;</span>, <span class="br0">&#40;</span><span class="nu0">920805600</span>,<span class="nu0">0</span><span class="br0">&#41;</span>, <span class="br0">&#40;</span><span class="nu0">920806800</span>,<span class="nu0">33</span><span class="br0">&#41;</span><span class="br0">&#41;</span></div>
</div>
<!-- Social Buttons Shared Counts Generated by Digg Digg plugin v4.2, 
    Author : Yong Mook Kim
    Website : http://www.mkyong.com/blog/digg-digg-wordpress-plugin/ -->			</div>	
			<p class="tagged"><span class="add_comment"><a href="../../2011/07/03/accessing-rrdtool-files-data-with-java/index.html#respond" title="Comment on Accessing rrdtool-files Data with Java / Scala">&rarr; No Comments</a></span><strong>Tags:</strong> <a href="../../category/software-engineering/technologies-tools/index.html" title="View all posts in Technologies/Tools" rel="category tag">Technologies/Tools</a></p>
			<div class="clear"></div>
			
								
						<h4 class="archive_date">>May 15th, 2011<!-- by manuel aldana --> &middot; <a href="../../2011/05/15/embracing-failure-softwareapproaches/index.html#respond" title="Comment on &#8216;Embrace Failure&#8217; approaches in Software Development">No Comments</a></h4>
			<h2 class="archive_body"><a href="../../2011/05/15/embracing-failure-softwareapproaches/index.html" rel="bookmark" title="Permanent Link to &#8216;Embrace Failure&#8217; approaches in Software Development">&#8216;Embrace Failure&#8217; approaches in Software Development</a></h2>

			<div class="entry">
				<div class='dd_post_share dd_post_share_left'><div class='dd_buttons'><div class='dd_button'><iframe src='http://widgets.dzone.com/links/widgets/zoneit.html?url=http://www.aldana-online.de/2011/05/15/embracing-failure-softwareapproaches/&amp;title=%27Embrace+Failure%27+approaches+in+Software+Development&amp;t=1' height='68' width='52' frameborder='0' scrolling='no'></iframe></div></div></div><p>Software-Developers (and humans generally) must not try to be 100% perfect but should take the imperfection as granted and &#8220;embrace&#8221; it. Following gives some thoughts on how to approach the &#8216;Embracing failure&#8217; principle in the field of Software Development.</p>
<h3>Log thoughtfully</h3>
<p>Proper and insightful logging cannot be overstated, you will praise the developer who provides good logs, i.e. you can easily search for problem-symptoms inside logs. Inside team find an appropriate logging convention for log-patterns + semantics of level. Some short and abbreviated ideas:</p>
<ul>
<li>DEBUG: Detailed information while going through integration points (like printing payload of XML for api call). Quantified information like statistics while refreshing/invalidating cache.</li>
<li>INFO: Bootstrapping/startup information, initialization routines, reoccurring asynchronous actions (including elapsed time).</li>
<li>WARN: Logging suspicious/errornous application state, where fallback is still possible and routine/call can be proceeded.</li>
<li>ERROR: No fallback possible. For the user/customer this most likely means a crashed call/request (in HTTP jargon this would be a 500 status). Examples for such failures could be NullPointers or database unavailability.</li>
</ul>
<p>NEVER EVER swallow away Exceptions, I&#8217;ve seen several empty catch{} blocks which later caused major headaches during production, on user-level the system crashed on many calls but nothing could be seen inside logs. At topmost application layer log uncaught Exceptions as ERROR.</p>
<p>Also have a look at a <a target="_blank" href="http://nurkiewicz.blogspot.com/2010/05/clean-code-clean-logs-use-appropriate.html">longer blog-entry</a> about appropriate logging.</p>
<h3>Make deployment + upgrade easy</h3>
<p>When a critical failure occurs you want to be able to react quickly. Reaction-time lasts between the time of knowing the issue until the deployment is finished and the customers sees the change. This includes getting the code (thank a fast SCM), understanding the problem, fixing/extending the code, verifying change on local and/or qa-environment and finally push to production. For building deployment package and executing deployment automate and speed up as much as possible. </p>
<p>If you are lucky your app is a typical browser-server based webapp. It has the highest potential regarding instant deployment: As soon as the new app version has been rolled out to your server machine (or server farm, in case you scaled out) the upgrade is complete and will be instantly seen inside the client&#8217;s browser. Yes, webapp deployments have their own pitfalls (high traffic site&#8217;s rollout isn&#8217;t atomic, cache settings, browser state inside DOM or cookies), but other application classes like embedded-systems, desktop-app or mobile-apps have much tougher deployment requirements and upgrade process is more complicated. But Google&#8217;s Chrome Webbrowser</a> shows that even for these applications a <a target="_blank" href="http://www.codinghorror.com/blog/2011/05/the-infinite-version.html">well designed and transparent upgrade mechanism is possible</a>.</p>
<h3>Monitor your application</h3>
<p>At some point the system will fail, therefore you have to focus on notfications of respective problems. A typical and annoying scenario is a &#8216;false negative&#8217; production system: You think everything is alright but in fact the production behaviour is unstable and unreliable. Unstable production behaviour can be infrastructure or application related. Infrastructure problems include network problems, disk crashes, external-system/integration-points downtime or not enough capacity/resources to handle the load. Application related are more &#8220;real&#8221; usual application bugs like unchecked null-references, dead-locks, infinity-loops, thread-unsafety or simply wrong implemented requirements.</p>
<p>To sense + sanity-check such problems you need system-hooks which deliver data (e.g. Servlet-Container built-in monitoring, JMX). Sometimes you will also write little extension to fulfill a specific monitoring requirement (e.g. ERROR log counter). Apart from data-provision you also need an entity which processes the numbers. To not hire monkeys you should use existing tools. For instance munin + rdd-tool tracks the data over time and plots nice graphs and Nagios alerts you actively in case of a peak of a metric and a potential incident.</p>
<h3>Make it visible</h3>
<p>We as humans are also far from perfect at number crunching and intepreting masses of detailed numeric data. Often application &#8220;health&#8221; degrades over time so you should deliver comparison of &#8216;now&#8217; to historic data (like hour over hour, day over day, week over week). Try to abstract away numbers behind meaningful graphs or charts. The signal light analogy (green, orange, red) also helps a lot to classify the criticality of numbers.</p>
<h3>Enabling live diagnostics</h3>
<p>Sometimes app behaviour isn&#8217;t well enough understood and you won&#8217;t be able to reproduce a scenario in local isolated environment. You then have to try to get more insight of production system. In case resources are the problem (like CPU, memory) several profilers support live production machine-instance attachements to get some metrics like running threads, heap-stats or garbage collector info. </p>
<p>If you need more semantically application insights and followed log conventions, you should also make it possible to enable DEBUG or TRACE logs for a certain code sections. Make your logging-levels configurable during runtime. If you have to restart your app when changing log-settings you can wipe away the current application&#8217;s state you want to analyse (issues are often not reproducible straight after restart).</p>
<p>Another helpful option is live debugging, where you debug remotely and direcetly on the problem-server instance. You can directly sense the concrete problem as is and don&#8217;t need to waste effort for local reproduction. One of your users will have bad luck and will hit a connection timeout, but the request anyway would have caused an error page.</p>
<h3>Use Users/Customers as feedback provider</h3>
<p>Even if you are running under a diagnostic friendly webapp (server is under app-provider&#8217;s control) you may end-up with very weird cases, which happen on the client&#8217;s side. Therefore make it very easy for customers to give you feedback, either provide free-phone-contact or a easy to find feedback form. In case you don&#8217;t run as webapp an option would also be that in case of an error the user just needs to click a button and some diagnostic data is sent to the server (I remember, when reporting a bug Ubuntu OS fetched a good deal of OS-configuration-data and attached it to the bug-report). Some embedded systems don&#8217;t need user action but automatically dump application-state to a persistent storage before a reset. This data then can be retrieved later from a mechanic inside a car repair-shop.</p>
<h3>Conclusion</h3>
<p>Your production system will fail at some point. You can try to fight this by getting your QA as close as possible to production and invest A LOT into testing. Still you have to find the sweet spot of cost/benefit ratio, because this effort increases exponentially (effort of providing same hardware, 100% test-coverage + test-data, simulate real-user behaviour, etc.). There are software-system classes where this effort must be pushed to the limits like in money + life critical intense systems, but most applications we are building aren&#8217;t that sensitive where damage cannot be tolerated or reversed. Therefore build in as many diagnostics as sensible and have good tooling + process around a quick alert/fix/deploy roundtrip.</p>
<!-- Social Buttons Shared Counts Generated by Digg Digg plugin v4.2, 
    Author : Yong Mook Kim
    Website : http://www.mkyong.com/blog/digg-digg-wordpress-plugin/ -->			</div>	
			<p class="tagged"><span class="add_comment"><a href="../../2011/05/15/embracing-failure-softwareapproaches/index.html#respond" title="Comment on &#8216;Embrace Failure&#8217; approaches in Software Development">&rarr; No Comments</a></span><strong>Tags:</strong> <a href="../../category/software-engineering/index.html" title="View all posts in Software Engineering" rel="category tag">Software Engineering</a></p>
			<div class="clear"></div>
			
								
						<h4 class="archive_date">>March 13th, 2011<!-- by manuel aldana --> &middot; <a href="../../2011/03/13/top-tools-for-logging-analysis-cli-based/index.html#respond" title="Comment on Top-Tools for Log-Analysis (CLI based)">No Comments</a></h4>
			<h2 class="archive_body"><a href="../../2011/03/13/top-tools-for-logging-analysis-cli-based/index.html" rel="bookmark" title="Permanent Link to Top-Tools for Log-Analysis (CLI based)">Top-Tools for Log-Analysis (CLI based)</a></h2>

			<div class="entry">
				<div class='dd_post_share dd_post_share_left'><div class='dd_buttons'><div class='dd_button'><iframe src='http://widgets.dzone.com/links/widgets/zoneit.html?url=http://www.aldana-online.de/2011/03/13/top-tools-for-logging-analysis-cli-based/&amp;title=Top-Tools+for+Log-Analysis+%28CLI+based%29+&amp;t=1' height='68' width='52' frameborder='0' scrolling='no'></iframe></div></div></div><p>After all the years it is still remarkable how powerful plain text is for software development (human readability, advanced SCM tools, expressiveness, no GUI necessary, etc.). This applies also on logging, where plain text makes a very nice source for doing adhoc analysis. Following samples show how bash, its interprocess-communication piping and the usual suspect tools (awk, grep, sed, tr, etc.) give you great control when doing analysis.</p>
<h3>Format</h3>
<p>Logs should have a standard format, so analysis can rely on structured output and operate on it, programs are less flexible as humans and need strict patterns. Most often such logs are line-based and white-space separate based. Fortunately most logging frameworks make this a non brainer (e.g apache log-format settings, log4j).</p>
<p>Usual log-pattern, rows/lines form single datasets and are most often ordered by time, because they are appended by the software over time, they often contain also timestamps. The lines most often are independant of each other, but for each line data needs to follow strict order (apart from loose text like error-messages or furhter stack traces):</p>
<div class="codesnip-container" >
<div class="codesnip">dataset1<span class="br0">&#40;</span>line1<span class="br0">&#41;</span>: data1 data2 data3<br />
dataset2<span class="br0">&#40;</span>line2<span class="br0">&#41;</span>: data1 data2 data3<br />
dataset3<span class="br0">&#40;</span>line3<span class="br0">&#41;</span>: data1 data2 data3<br />
&#8230;</div>
</div>
<p>To better understand examples I refer to apache-logging pattern (HTTP based web-traffic). Still all the example adhoc queries can be applied to all other log-output target/formats:</p>
<div class="codesnip-container" >&#8230;<br />
127.0.0.1 &#8211; - [29/Feb/2011:13:58:50 +0100] &#8220;GET /api/image/status/ok HTTP/1.1&#8243; 200 476 &#8220;-&#8221; &#8220;Jakarta Commons-HttpClient/3.1&#8243;<br />
&#8230;</div>
<h3>Log analysis in Action</h3>
<p>Quick overview for further analysis steps:</p>
<div class="codesnip-container" >
<div class="codesnip"><span class="co1"># using &#8216;less&#8217; so reading longer output is easier</span><br />
grep <span class="st0">&#8221; 200 &#8220;</span> log-file | less</p>
<p><span class="co1"># only direct stuff to &#8216;less&#8217; which is of interest, in this case show relative URI path (7th position)</span><br />
grep <span class="st0">&#8221; 200 &#8220;</span> log-file | awk <span class="st0">&#8216;{print $7}&#8217;</span> | less</p>
<p><span class="co1"># plain text is good candidate for compressing therefore on production</span><br />
<span class="co1"># environment files are often zipped to save disk space, therefore use zgrep</span><br />
zgrep * | awk <span class="st0">&#8216;{print $7}&#8217;</span> | less</div>
</div>
<p>Counts:</p>
<div class="codesnip-container" >
<div class="codesnip"><span class="co1"># count of HTTP calls which had 404 status</span><br />
grep -c <span class="st0">&#8221; 404 &#8220;</span> log-file<br />
<span class="co1"># more verbose equivalent</span><br />
cat log-file | grep <span class="st0">&#8221; 404 &#8220;</span> | wc -l</p>
<p><span class="co1"># count of all other but 404 HTTP status (inverse grep)</span><br />
grep -v -c <span class="st0">&#8221; 404 &#8220;</span> log-file</p>
<p><span class="co1"># piping (filtering step-by-step)</span><br />
<span class="co1"># showing number of failed (non 201 status) image uploads (POST)</span><br />
cat log-file | grep -v <span class="st0">&#8221; 201 &#8220;</span> | grep POST | grep image | wc -l</div>
</div>
<p>Filtering:</p>
<div class="codesnip-container" >
<div class="codesnip"><span class="co1"># spit out all respone times of HTTP 200 status</span><br />
<span class="co1"># response time is whitespace-separated on 10th position</span><br />
grep <span class="st0">&#8221; 200 &#8220;</span> log-file | awk <span class="st0">&#8216;{print $10}&#8217;</span></p>
<p><span class="co1"># show number of&nbsp; unique called URLs (stand on 7th position)</span><br />
cat log-file | awk <span class="st0">&#8216;{print $7}&#8217;</span> | uniq</p>
<p><span class="co1"># show slowest response time</span><br />
grep <span class="st0">&#8221; 200 &#8220;</span> log-file | awk <span class="st0">&#8216;{print $10}&#8217;</span> | sort -n | tail -n1<br />
<span class="co1"># show fastest response time</span><br />
grep <span class="st0">&#8221; 200 &#8220;</span> log-file | awk <span class="st0">&#8216;{print $10}&#8217;</span> | sort -n | head -n1</p>
<p><span class="co1"># filter lines &#8216;from,to&#8217; (e.g. analyse critical time section)</span><br />
cat log-file | sed -n <span class="st0">&#8216;20,30&#8242;</span></div>
</div>
<p>Transformations:</p>
<div class="codesnip-container" >
<div class="codesnip"><span class="co1"># chain response times with &#8216;,&#8217; instead of linebreaks &#8216;\n&#8217;</span><br />
grep <span class="st0">&#8221; 200 &#8220;</span> log-file | awk <span class="st0">&#8216;{print $10}&#8217;</span> | tr -d <span class="st0">&#8220;<span class="es0">\n</span>&#8220;</span> <span class="st0">&#8220;,&#8221;</span></p>
<p><span class="co1"># delete/omit lines 10-20</span><br />
cat log-file | awk <span class="st0">&#8216;{print $10}&#8217;</span> | sed <span class="st0">&#8216;20,30d&#8217;</span><br />
<span class="co1"># slightly shorter</span><br />
awk <span class="st0">&#8216;{print $10}&#8217;</span> &lt;&nbsp; log-file | sed <span class="st0">&#8216;20,30d&#8217;</span></div>
</div>
<p>Side-Note: While running adhoc log-files queries, often it is enough to go the pragmatic way, e.g. above I used the &#8221; 404 &#8221; in grep command which is not correct (404 could occur inside the response time part also). Never the less it is quicker and shorter to write and collision is unlikely.</p>
<h3>Server farm approach (horizontal scaled)</h3>
<p>How do you run log-analysis in server-farm environments (lots of machines are used to scale up horizontally)? In this situation logs are distributed around on each machine&#8217;s log directory. An option here  is to have a dedicated more storage focused server which runs a batch/cron-job over night copying all the server logs to a single place. This of course is practicable if the files aren&#8217;t too huge and can be processed in reasonable time by single script. If this is not the case you may want to use a more scalable sophisticated solution (like MapReduce with Hadoop). Another alternative is to analyse log on single machine and extrapolate. Most likely you use a load-balancer which causes the traffic to be distributed equally on each machine, i.e. running the same log-query on each machine would give back similar results. The big advantage of the single machine is simplicity: no infrastructure necessary (terminal and log-file sufficient), commands are simple one-liners and speed (only one machine log-file needs to be analysed).</p>
<h3>Summary</h3>
<p>The CLI triangle (bash, its utilities, piping) form a very convenient  ad-hoc query-interface for logs. At first glance they look a bit cryptic, but you get used to it very quickly. Also you already achieve a lot by only knowing a small subset of functionality (e.g. I use only a minimum subset of &#8216;awk&#8217; and &#8217;sed&#8217;). </p>
<p>Am happy about any comments/hints of other lightweight tooling for log-analysis.</p>
<!-- Social Buttons Shared Counts Generated by Digg Digg plugin v4.2, 
    Author : Yong Mook Kim
    Website : http://www.mkyong.com/blog/digg-digg-wordpress-plugin/ -->			</div>	
			<p class="tagged"><span class="add_comment"><a href="../../2011/03/13/top-tools-for-logging-analysis-cli-based/index.html#respond" title="Comment on Top-Tools for Log-Analysis (CLI based)">&rarr; No Comments</a></span><strong>Tags:</strong> <a href="../../category/uncategorized/index.html" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a></p>
			<div class="clear"></div>
			
						
			
<div class="newer_older">
	 <div class="newer">&lt;<a href="../../index.html" >Newer entries </a></div> 	<div class="older"><a href="../3/index.html" >Older entries</a>&gt;</div>
</div>
<div class="clear flat"></div>

			
				
		</div>
	

	
	</div>

	<div id="footer">
	
  
  <p>	 
    &copy; 2007&ndash;2010 Software Engineering blog &amp; .more  &mdash; <a href="../../sitemap.xml">Sitemap</a> &mdash; Manuel Aldana
		      
  </p>
  <p>
			<a href="http://www.mozilla.org/products/firefox/" target="_blank" title="Get Firefox"><img src="../../getfirefox_small.png"  border="0" alt="Get Firefox" /></a>  
</p>
  
	</div>
</div>

</body>
</html>
